<!-- /*
* Bootstrap 5
* Template Name: Furni
* Template Author: Untree.co
* Template URI: https://untree.co/
* License: https://creativecommons.org/licenses/by/3.0/
*/ -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="author" content="Untree.co" />
    <link rel="shortcut icon" href="favicon.png" />

    <meta name="description" content="" />
    <meta name="keywords" content="bootstrap, bootstrap4" />

    <!-- Bootstrap CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet" />
    <!-- Font Awesome (latest stable only) -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />

    <!-- Bootstrap Icons (optional, only once) -->
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    />

    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Cookie&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />

    <!-- Css Styles -->
    <link rel="stylesheet" href="css3/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="css3/elegant-icons.css" type="text/css" />
    <link rel="stylesheet" href="css3/jquery-ui.min.css" type="text/css" />
    <link rel="stylesheet" href="css3/magnific-popup.css" type="text/css" />
    <link rel="stylesheet" href="css3/owl.carousel.min.css" type="text/css" />
    <link rel="stylesheet" href="css3/slicknav.min.css" type="text/css" />
    <link rel="stylesheet" href="css3/style.css" type="text/css" />

    <link href="css/tiny-slider.css" rel="stylesheet" />
    <link href="css/style.css" rel="stylesheet" />
    <link rel="stylesheet" href="css/tempusStyle.css" />
    <link rel="stylesheet" href="css/productListingStyle.css" />
    <title>Tempus</title>
  </head>

  <body>
    <!--HEADER-->
    <%- include('../../views/partials/user/header')%>
    <!--HEADER-->
    <div class="container-fluid my-5">
      <div class="row">
        <!-- Sidebar Filters -->
        <div class="col-md-3">
          <h2 class="h2" id="sidebarHead">FILTERS</h2>
          <div class="filter-sidebar">
            <form id="filterForm" action="/collections" method="get">
              <div class="accordion" id="filterAccordion">
                <!-- Category -->
                <div class="accordion-item">
                  <h2
                    class="accordion-header d-flex align-items-center justify-content-between"
                    id="headingGender"
                  >
                    <button
                      class="accordion-button collapsed"
                      type="button"
                      data-bs-toggle="collapse"
                      data-bs-target="#collapseCategory"
                    >
                      Category
                    </button>
                    <button
                      type="button"
                      class="clear-btn"
                      data-filter="category"
                      id="clear-btn_category"
                      style="display: none"
                    >
                      Clear
                    </button>
                  </h2>

                  <div
                    id="collapseCategory"
                    class="accordion-collapse collapse"
                    data-bs-parent="#filterAccordion"
                  >
                    <div class="accordion-body">
                      <%categoryStats.forEach((catItem)=>{%>
                      <div class="form-check">
                        <input
                          class="form-check-input"
                          type="checkbox"
                          id="category_<%=catItem.category%>"
                          name="category"
                          value="<%=catItem._id%>"
                        />
                        <label
                          class="form-check-label"
                          for="category_<%=catItem.category%>"
                          ><%=catItem.category%>
                          (<%=catItem.count%>)</label
                        >
                      </div>
                      <%})%>
                    </div>
                  </div>
                </div>

                <!-- Brand -->
                <div class="accordion-item">
                  <h2
                    class="accordion-header d-flex align-items-center justify-content-between"
                    id="headingBrand"
                  >
                    <button
                      class="accordion-button collapsed"
                      type="button"
                      data-bs-toggle="collapse"
                      data-bs-target="#collapseBrand"
                    >
                      Brand
                    </button>
                    <button
                      type="button"
                      class="clear-btn"
                      data-filter="brand"
                      id="clear-btn_brand"
                      style="display: none"
                    >
                      Clear
                    </button>
                  </h2>
                  <div
                    id="collapseBrand"
                    class="accordion-collapse collapse"
                    data-bs-parent="#filterAccordion"
                  >
                    <div class="accordion-body">
                      <%brandStats.forEach((brandItem)=>{%>
                      <div class="form-check">
                        <input
                          class="form-check-input"
                          type="checkbox"
                          id="brand_<%=brandItem.brand%>"
                          value="<%=brandItem.brand%>"
                          name="brand"
                        />
                        <label
                          class="form-check-label"
                          for="brand_<%=brandItem.brand%>"
                          ><%=brandItem.brand%>
                        </label>
                      </div>
                      <%})%>
                    </div>
                  </div>
                </div>

                <!-- Price -->
                <div class="accordion-item">
                  <h2
                    class="accordion-header d-flex align-items-center justify-content-between"
                    id="headingPrice"
                  >
                    <button
                      class="accordion-button collapsed"
                      type="button"
                      data-bs-toggle="collapse"
                      data-bs-target="#collapsePrice"
                    >
                      Price (₹)
                    </button>
                    <button
                      type="button"
                      class="clear-btn"
                      data-filter="price"
                      id="clear-btn_price"
                      style="display: none"
                    >
                      Clear
                    </button>
                  </h2>
                  <div
                    id="collapsePrice"
                    class="accordion-collapse collapse"
                    data-bs-parent="#filterAccordion"
                  >
                    <div class="accordion-body">
                      <div class="accordion-body">
                        <%priceStats.forEach((priceItem)=>{%>
                        <div class="form-check">
                          <input
                            class="form-check-input"
                            type="checkbox"
                            id="price_<%= priceItem.priceRanges %>"
                            value="<%= priceItem.priceRanges %>"
                            name="price"
                          />
                          <label
                            class="form-check-label"
                            for="price_<%= priceItem.priceRanges %>"
                            ><%= priceItem.priceRanges %>
                            (<%=priceItem.count%>)</label
                          >
                        </div>
                        <%})%>
                      </div>
                    </div>
                  </div>
                </div>

                <!-- case size -->
                <div class="accordion-item">
                  <h2
                    class="accordion-header d-flex align-items-center justify-content-between"
                    id="headingCaseSize"
                  >
                    <button
                      class="accordion-button collapsed"
                      type="button"
                      data-bs-toggle="collapse"
                      data-bs-target="#collapseCaseSize"
                    >
                      Case Size
                    </button>
                    <button
                      type="button"
                      class="clear-btn"
                      data-filter="caseSize"
                      id="clear-btn_caseSize"
                      style="display: none"
                    >
                      Clear
                    </button>
                  </h2>
                  <div
                    id="collapseCaseSize"
                    class="accordion-collapse collapse"
                    data-bs-parent="#filterAccordion"
                  >
                    <div class="accordion-body">
                      <%caseSizeStats.forEach((caseSizeItem)=>{%>
                      <div class="form-check">
                        <input
                          class="form-check-input"
                          type="checkbox"
                          id="caseSize_<%= caseSizeItem._id.min %>-<%= caseSizeItem._id.max %>"
                          value="<%= caseSizeItem._id.min %>-<%= caseSizeItem._id.max %>"
                          name="caseSize"
                        />
                        <label class="form-check-label" for="price1"
                          ><%= caseSizeItem._id.min %>-<%= caseSizeItem._id.max %>
                          mm (<%=caseSizeItem.count%>)</label
                        >
                      </div>
                      <%})%>
                    </div>
                  </div>
                </div>

                <!-- Strap color -->
                <div class="accordion-item">
                  <h2
                    class="accordion-header d-flex align-items-center justify-content-between"
                    id="headingBrand"
                  >
                    <button
                      class="accordion-button collapsed"
                      type="button"
                      data-bs-toggle="collapse"
                      data-bs-target="#collapseStrapColor"
                    >
                      Strap color
                    </button>
                    <button
                      type="button"
                      class="clear-btn"
                      data-filter="strapColor"
                      id="clear-btn_strapColor"
                      style="display: none"
                    >
                      Clear
                    </button>
                  </h2>
                  <div
                    id="collapseStrapColor"
                    class="accordion-collapse collapse"
                    data-bs-parent="#filterAccordion"
                  >
                    <div class="accordion-body">
                      <% strapColorStats.forEach((strpColorItem) => { %>
                      <div class="form-check d-inline-block me-2 mb-2">
                        <!-- Hidden checkbox -->
                        <input
                          class="form-check-input d-none"
                          type="checkbox"
                          id="strapColor_<%= strpColorItem.strapColor %>"
                          value="<%= strpColorItem.strapColor %>"
                          name="strapColor"
                        />

                        <!-- Label styled as round color swatch -->
                        <label
                          class="color-swatch"
                          for="strapColor_<%= strpColorItem.strapColor %>"
                          style="
                            background-color: <%= strpColorItem.strapColor %>;
                            border: 2px solid <%= strpColorItem.strapColor %>;
                          "
                          title="<%= strpColorItem.strapColor %> (<%= strpColorItem.count %>)"
                        ></label>
                      </div>
                      <% }) %>
                    </div>
                  </div>
                </div>

                <!-- Dial Color -->
                <div class="accordion-item">
                  <h2
                    class="accordion-header d-flex align-items-center justify-content-between"
                    id="headingBrand"
                  >
                    <button
                      class="accordion-button collapsed"
                      type="button"
                      data-bs-toggle="collapse"
                      data-bs-target="#collapseDialColor"
                    >
                      Dial Color
                    </button>
                    <button
                      type="button"
                      class="clear-btn"
                      data-filter="dialColor"
                      id="clear-btn_dialColor"
                      style="display: none"
                    >
                      Clear
                    </button>
                  </h2>
                  <div
                    id="collapseDialColor"
                    class="accordion-collapse collapse"
                    data-bs-parent="#filterAccordion"
                  >
                    <div class="accordion-body">
                      <% dialColorStats.forEach((dialColorItem) => { %>
                      <div class="form-check d-inline-block me-2 mb-2">
                        <!-- Hidden checkbox -->
                        <input
                          class="form-check-input d-none"
                          type="checkbox"
                          id="dialColor_<%= dialColorItem.dialColor %>"
                          value="<%= dialColorItem.dialColor %>"
                          name="dialColor"
                        />

                        <!-- Round color swatch -->
                        <label
                          class="color-swatch"
                          for="dialColor_<%= dialColorItem.dialColor %>"
                          style="
                            background-color: <%= dialColorItem.dialColor %>;
                          "
                          title="<%= dialColorItem.dialColor %> (<%= dialColorItem.count %>)"
                        ></label>
                      </div>
                      <% }) %>
                    </div>
                  </div>
                </div>

                <!-- movement -->
                <div class="accordion-item">
                  <h2
                    class="accordion-header d-flex align-items-center justify-content-between"
                    id="headingMovement"
                  >
                    <button
                      class="accordion-button collapsed"
                      type="button"
                      data-bs-toggle="collapse"
                      data-bs-target="#collapseMovement"
                    >
                      movement
                    </button>
                    <button
                      type="button"
                      class="clear-btn"
                      data-filter="movement"
                      id="clear-btn_movement"
                      style="display: none"
                    >
                      Clear
                    </button>
                  </h2>
                  <div
                    id="collapseMovement"
                    class="accordion-collapse collapse"
                    data-bs-parent="#filterAccordion"
                  >
                    <div class="accordion-body">
                      <%movementStats.forEach((mvmntItem)=>{%>
                      <div class="form-check">
                        <input
                          class="form-check-input"
                          type="checkbox"
                          id="movement_<%=mvmntItem.movement%>"
                          value="<%=mvmntItem.movement%>"
                          name="movement"
                        />
                        <label
                          class="form-check-label"
                          for="movement_<%=mvmntItem.movement%>"
                          ><%=mvmntItem.movement%>
                          (<%=mvmntItem.count%>)</label
                        >
                      </div>
                      <%})%>
                    </div>
                  </div>
                </div>
              </div>
            </form>
          </div>
        </div>

        <!-- Product Grid -->
        <div class="col-md-9">
          <div class="d-flex justify-content-between mb-3">
            <div id="total-products" class="mb-3"><%= total %> Products</div>

            <div class="dropdown dropdown-menu-end">
              <button
                type="button"
                class="btn btn-white btn-outline-dark dropdown-toggle"
                data-bs-toggle="dropdown"
              >
                Sort by
              </button>
              <ul class="dropdown-menu">
                <li>
                  <a class="dropdown-item" onclick="setFilter('manual')"
                    >Manual</a
                  >
                </li>
                <li>
                  <a
                    class="dropdown-item"
                    onclick="setFilter('price-descending')"
                    >Price : high to low</a
                  >
                </li>
                <li>
                  <a
                    class="dropdown-item"
                    onclick="setFilter('price-ascending')"
                    >Price : low to high</a
                  >
                </li>
                <li>
                  <a
                    class="dropdown-item"
                    onclick="setFilter('title-ascending')"
                    >aA - zZ</a
                  >
                </li>
                <li>
                  <a
                    class="dropdown-item"
                    onclick="setFilter('title-descending')"
                    >zZ - aA</a
                  >
                </li>
              </ul>
            </div>
          </div>
          <hr style="color: rgb(91, 91, 91)" />
          <div id="products-container">
            <div class="row g-3">
              <% if (products && products.length > 0) { %> <%
              products.forEach(product => { const isInWishlist =
              Array.isArray(wishlist) && product && product._id ?
              wishlist.some(item => item.items &&
              item.items.productId?.toString() === product._id.toString()) :
              false; %>
              <div class="col-md-4 col-sm-6">
                <div class="product-card mx-4 my-2">
                  <div class="product-image">
                    <img
                      src="<%= product.variants[0].variantImages[0] %>"
                      alt="<%= product.productName %>"
                    />

                    <a
                      href="/wishlist/add?productId=<%= product._id %>&variantId=<%= product.variants[0]._id %>"
                      class="wishlist-btn text-decoration-none"
                    >
                      <i
                        class="fa <%= isInWishlist ? 'fa-solid active' : 'fa-regular' %> fa-heart wishlist-icon"
                      ></i>
                    </a>
                  </div>
                  <a
                    href="/collections/<%= product._id %>?variantId=<%= product.variants[0]._id %>"
                    class="text-decoration-none text-dark"
                  >
                    <div class="product-details">
                      <h4><%= product.productName %></h4>

                      <p class="product-price">
                        ₹<%= product.minPrice %> <% if (product.maxPrice !==
                        product.minPrice) { %> - ₹<%= product.maxPrice %> <% }
                        %>
                      </p>
                    </div>
                  </a>
                </div>
              </div>

              <% }) %>
              <% } else { %>
              <p>No products found</p>
              <% } %>
            </div>
          </div>
        </div>

        <!-- PAGINATION -->
        <!-- PAGINATION -->
        <div id="pagination" class="d-flex justify-content-end mt-5">
          <nav>
            <ul class="pagination">
              <% if (page > 1) { %>
              <li class="page-item">
                <a
                  class="page-link prev"
                  href="?page=<%= page - 1 %>&search=<%= search %>"
                  >Prev</a
                >
              </li>
              <% } %>

              <% for (let i = 1; i <= totalPages; i++) { %>
              <li class="page-item <%= page === i ? 'active' : '' %>">
                <a class="page-link" href="?page=<%= i %>&search=<%= search %>"
                  ><%= i %></a
                >
              </li>
              <% } %>

              <% if (page < totalPages) { %>
              <li class="page-item">
                <a
                  class="page-link next"
                  href="?page=<%= page + 1 %>&search=<%= search %>"
                  >Next</a
                >
              </li>
              <% } %>
            </ul>
          </nav>
        </div>

        <!-- PAGINATION -->
      </div>
    </div>

    <!--FOOTER-->
    <%- include('../../views/partials/user/footer')%>
    <!--FOOTER-->
    <script src="js/bootstrap.bundle.min.js"></script>
    <script src="js/tiny-slider.js"></script>
    <script src="js/custom.js"></script>
    <script src="js/templateJS.js"></script>
    <script src="js/productListing.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
      const success_msg =
        "<%= success_msg && success_msg.length > 0 ? success_msg[0] : '' %>";
      const error_msg =
        "<%= error_msg && error_msg.length > 0 ? error_msg[0] : '' %>";

      if (success_msg && success_msg.length > 0) {
        Swal.fire({
          icon: 'success',
          title: 'Success',
          text: success_msg,
          confirmButtonColor: '#3085d6',
        });
      }

      if (error_msg && error_msg.length > 0) {
        Swal.fire({
          icon: 'error',
          title: 'Error',
          text: error_msg,
          confirmButtonColor: '#d33',
        });
      }
    </script>
  </body>
</html>
