<!-- /*
* Bootstrap 5
* Template Name: Furni
* Template Author: Untree.co
* Template URI: https://untree.co/
* License: https://creativecommons.org/licenses/by/3.0/
*/ -->
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, shrink-to-fit=no"
    />
    <meta name="author" content="Untree.co" />
    <link rel="shortcut icon" href="/favicon.png" />

    <meta name="description" content="" />
    <meta name="keywords" content="bootstrap, bootstrap4" />

    <!-- Bootstrap CSS -->
    <link href="/css/bootstrap.min.css" rel="stylesheet" />
    <link
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css"
      rel="stylesheet"
    />
    <link
      rel="stylesheet"
      href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.css"
    />
    <!-- Font Awesome (latest stable) -->
    <link
      rel="stylesheet"
      href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css"
    />
    <!-- Google Fonts -->
    <link
      href="https://fonts.googleapis.com/css2?family=Cookie&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700;800;900&display=swap"
      rel="stylesheet"
    />

    <!-- Css Styles -->
    <link rel="stylesheet" href="/css3/bootstrap.min.css" type="text/css" />
    <link rel="stylesheet" href="/css3/elegant-icons.css" type="text/css" />
    <link rel="stylesheet" href="/css3/jquery-ui.min.css" type="text/css" />
    <link rel="stylesheet" href="/css3/magnific-popup.css" type="text/css" />
    <link rel="stylesheet" href="/css3/owl.carousel.min.css" type="text/css" />
    <link rel="stylesheet" href="/css3/slicknav.min.css" type="text/css" />
    <link rel="stylesheet" href="/css3/style.css" type="text/css" />

    <link href="/css/tiny-slider.css" rel="stylesheet" />
    <link href="/css/style.css" rel="stylesheet" />
    <link rel="stylesheet" href="/css/tempusStyle.css" />
    <link rel="stylesheet" href="/css3/productDetailsStyle.css" />
    <title>Tempus</title>
  </head>

  <body>
    <!--HEADER-->
    <%- include('../../views/partials/user/header')%>
    <!--HEADER-->

    <div class="untree_co-section before-footer-section">
      <div class="container">
        <div class="row mb-5">
          <form class="col-md-12" method="post">
            <div class="site-blocks-table">
              <table class="table">
                <%if(cartItems){%>
                <thead>
                  <tr>
                    <th class="product-thumbnail">Image</th>
                    <th class="product-name">Product</th>
                    <th class="product-price">Price</th>
                    <th class="product-quantity">Quantity</th>
                    <th class="product-total">Total</th>
                    <th class="product-remove">Remove</th>
                  </tr>
                </thead>
                <%}%>
                <tbody>
                  <%if(cartItems){%>
                  <%cartItems.items.forEach((item)=>{%>
                  <tr
                    class="<%= item.quantity == 0 ? 'table-secondary text-muted' : '' %>"
                  >
                    <td class="product-thumbnail">
                      <a
                        href="/collections/<%=item.productId%>?variantId=<%=item.variantId%>"
                      >
                        <img
                          src="<%=item.variantDetails.variantImages[0]%>"
                          alt="Image"
                          class="img-fluid"
                        />
                      </a>
                    </td>
                    <td class="product-name">
                      <h2 class="h5 text-black"><%=item.productName%></h2>
                      <% if(item.quantity <= 0){ %>
                      <small class="text-danger fw-bold"
                        >⚠ This item is out of stock</small
                      >
                      <% } %>
                    </td>
                    <td>₹<%=item.price%></td>
                    <td>
                      <div
                        class="input-group mb-3 d-flex align-items-center quantity-container"
                        style="max-width: 120px"
                      >
                        <div class="input-group-prepend">
                          <a
                            href="/cart/decreaseQty?userId=<%=cartItems.userId%>&productId=<%=item.productId%>&variantId=<%=item.variantId%>"
                            class="btn btn-outline-black decrease <%= item.quantity == 0 ? 'disabled' : '' %>"
                          >
                            &minus;
                          </a>
                        </div>
                        <input
                          type="text"
                          class="form-control text-center quantity-amount"
                          value="<%=item.quantity%>"
                          readonly
                        />
                        <div class="input-group-append">
                          <a
                            href="/cart/increaseQty?userId=<%=cartItems.userId%>&productId=<%=item.productId%>&variantId=<%=item.variantId%>"
                            class="btn btn-outline-black increase <%= item.quantity == 0 ? 'disabled' : '' %>"
                          >
                            &plus;
                          </a>
                        </div>
                      </div>
                    </td>
                    <td>
                      <%if(cartItems.couponApplied.isApplied){%>
                      ₹<%=item.finalDiscountedPrice%>
                      <span class="text-decoration-line-through text-danger">
                        ₹<%=item.total%>
                      </span>
                      <%}else{%>

                      ₹<%=item.total%>
                      <%}%>
                    </td>
                    <td>
                      <button
                        type="button"
                        class="btn btn-black btn-sm removeFromCart"
                        data-user-id="<%=cartItems.userId%>"
                        data-product-id="<%=item.productId%>"
                        data-variant-id="<%=item.variantId%>"
                        data-quantity="<%=item.quantity%>"
                      >
                        X
                      </button>
                    </td>
                  </tr>

                  <%})%>
                  <%}else if(!cartItems){%>
                  <div
                    class="d-flex flex-column align-items-center justify-content-center"
                  >
                    <h3>No products in cart..!</h3>
                    <div class="mt-5">
                      <a
                        href="/collections"
                        class="btn btn-outline-black btn-lg"
                      >
                        Shop Now
                      </a>
                    </div>
                  </div>
                  <%}%>
                </tbody>
              </table>
            </div>
          </form>
        </div>

        <%if(cartItems){%>
        <% let sum = cartItems.items.reduce((acc, curr) => acc + curr.total, 0);
        %>

        <div class="row">
          <div class="col-md-6">
            <div class="row mb-5">
              <div class="col-md-6">
                <a
                  href="/collections"
                  class="btn btn-outline-black btn-sm btn-block"
                >
                  Continue Shopping
                </a>
              </div>
            </div>
            <div class="row">
              <div class="col-md-12">
                <div class="p-3 p-lg-5 border bg-white">
                  <% if (cartItems.couponApplied &&
                  cartItems.couponApplied.isApplied) { %>
                  <div>
                    <p class="text-info">
                      Only one coupon can be applied at a time
                    </p>
                  </div>
                  <%}%>
                  <div
                    class="col-md-12 d-flex justify-content-start align-items-center my-3"
                  >
                    <div>
                      <label class="text-black h4 me-3" for="coupon"
                        >Coupons</label
                      >
                    </div>
                    <div>
                      <button
                        class="btn btn-black"
                        data-bs-toggle="modal"
                        data-bs-target="#couponModal"
                      >
                        View Coupons
                      </button>
                    </div>

                    <!-- COUPONS MODAL -->
                    <div
                      class="modal fade"
                      id="couponModal"
                      tabindex="-1"
                      aria-hidden="true"
                    >
                      <div class="modal-dialog modal-dialog-centered modal-lg">
                        <div class="modal-content">
                          <div class="modal-header">
                            <h5 class="modal-title">Available Coupons</h5>

                            <button
                              type="button"
                              class="btn-close"
                              data-bs-dismiss="modal"
                            ></button>
                          </div>

                          <div class="modal-body">
                            <!-- Coupon 1 -->
                            <%if(coupons){%>
                            <%coupons.forEach((coupon)=>{ const isEligible =
                            (sum >= coupon.minPurchaseAmount); %>
                            <div
                              class="coupon-card d-flex justify-content-between align-items-center"
                            >
                              <div
                                class="bg-light my-2 d-flex justify-content-between"
                                style="width: 2000px"
                              >
                                <div>
                                  <div class="coupon-code">
                                    <span
                                      class="border border-secondary p-2"
                                      data-id="<%= coupon._id %>"
                                    >
                                      <%=coupon.couponCode%></span
                                    >
                                  </div>
                                  <div class="coupon-desc">
                                    <%=coupon.description%>
                                  </div>
                                </div>
                                <%if(isEligible){%>

                                <% if (cartItems && cartItems.couponApplied && cartItems.couponApplied.isApplied) { %>
                                <%if(cartItems.couponApplied.couponCode){%>
                                <button
                                  class="btn btn-sm btn-outline-secondary"
                                  disabled
                                >
                                  Apply
                                </button>

                                <%}else if (cartItems.couponApplied.couponId.toString() === coupon._id.toString()) { %>
                                <!-- Applied coupon: show Remove -->
                                <button
                                  class="btn btn-sm btn-danger"
                                  onclick="removeCoupon(this)"
                                  data-coupon-id="<%= coupon._id %>"
                                >
                                  Remove
                                </button>
                                <% } else { %>
                                <!-- Other coupons disabled -->
                                <button
                                  class="btn btn-sm btn-outline-secondary"
                                  disabled
                                >
                                  Apply
                                </button>
                                <% } %>
                                <% } else { %>
                                <!-- No coupon applied yet -->
                                <button
                                  class="btn btn-sm btn-outline-danger"
                                  onclick="applyCode(this)"
                                  data-coupon-id="<%= coupon._id %>"
                                  data-cart-total="<%= sum %>"
                                >
                                  Apply
                                </button>
                                <% } %>

                                <%}else{%>

                                <div>
                                  <p>
                                    Minimum purcahse amount is
                                    <%=coupon.minPurchaseAmount %>
                                  </p>
                                </div>

                                <%}%>
                              </div>
                            </div>
                            <%})%>
                            <%}else{%>
                            <div>No coupons to show...</div>
                            <%}%>
                          </div>
                        </div>
                      </div>
                    </div>
                    <!-- COUPONS MODAL -->
                  </div>
                  <label for="c_code" class="text-black mb-3"
                    >Enter your coupon code if you have one</label
                  >
                  <div class="input-group w-75 couponcode-wrap">
                    <% if (cartItems.couponApplied &&
                    cartItems.couponApplied.isApplied &&
                    cartItems.couponApplied.couponAmount) { %>

                    <input
                      type="text"
                      class="form-control me-2"
                      id="c_applied_code"
                      value="<%=cartItems.couponApplied.couponCode%>"
                      aria-label="Coupon Code"
                      aria-describedby="button-addon2"
                      disabled
                    />

                    <%}else{%>
                    <input
                      type="text"
                      class="form-control me-2"
                      id="c_code"
                      placeholder="Coupon Code"
                      aria-label="Coupon Code"
                      aria-describedby="button-addon2"
                    />
                    <%}%>
                    <div class="input-group-append">
                      <% if (cartItems.couponApplied &&
                      cartItems.couponApplied.isApplied &&
                      cartItems.couponApplied.couponCode) { %>

                      <button
                        class="btn btn-black btn-sm"
                        type="button"
                        id="button-addon2"
                        onclick="removeOtherCodes(this)"
                      >
                        Remove
                      </button>

                      <%}else if (cartItems.couponApplied &&
                      cartItems.couponApplied.isApplied) { %>
                      <button
                        class="btn btn-black btn-sm"
                        type="button"
                        id="button-addon2"
                        disabled
                      >
                        Apply
                      </button>
                      <%}else{%>
                      <button
                        class="btn btn-black btn-sm"
                        type="button"
                        id="button-addon2"
                        data-cart-total="<%= sum %>"
                        onclick="applyOtherCodes(this)"
                      >
                        Apply
                      </button>
                      <%}%>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <div class="col-md-6 pl-5">
            <div class="row justify-content-end">
              <div class="col-md-7">
                <div class="row">
                  <div class="col-md-12 text-right border-bottom mb-5">
                    <h3 class="text-black h4 text-uppercase">Cart Totals</h3>
                  </div>
                </div>
                <div class="row mb-3">
                  <div class="col-md-6">
                    <span class="text-black">Subtotal</span>
                  </div>
                  <div class="col-md-6 text-right">
                    <strong class="text-black">₹<%=sum%></strong>
                  </div>
                </div>

                <%if(cartItems.couponApplied.isApplied){%>
                <div class="row mb-5">
                  <div class="col-md-6">
                    <span class="text-black">Discount Applied</span>
                  </div>
                  <div class="col-md-6 text-right">
                    <strong class="text-danger"
                      >-₹<%=cartItems.couponApplied.couponAmount%></strong
                    >
                  </div>
                </div>

                <div class="row mb-5">
                  <div class="col-md-6">
                    <span class="text-black">Total</span>
                  </div>
                  <div class="col-md-6 text-right">
                    <strong class="text-black"
                      >₹<%=sum-cartItems.couponApplied.couponAmount%></strong
                    >
                  </div>
                </div>
                <%}else{%>

                <div class="row mb-5">
                  <div class="col-md-6">
                    <span class="text-black">Total</span>
                  </div>
                  <div class="col-md-6 text-right">
                    <strong class="text-black">₹<%=sum%></strong>
                  </div>
                </div>
                <%}%>

                <div class="row">
                  <div class="col-md-12">
                    <a
                      href="/goToCheckout"
                      class="btn btn-black btn-lg py-3 btn-block"
                    >
                      Proceed To Checkout
                    </a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        </div>

        <%}else if(!cartItems){%>
        <div></div>
        <%}%>
      </div>
    </div>

    <!--FOOTER-->
    <%- include('../../views/partials/user/footer')%>
    <!--FOOTER-->
    <!-- Js Plugins -->
    <script src="/js3/jquery-3.3.1.min.js"></script>
    <script src="/js3/bootstrap.min.js"></script>
    <script src="/js3/jquery.magnific-popup.min.js"></script>
    <script src="/js3/jquery-ui.min.js"></script>
    <script src="/js3/mixitup.min.js"></script>
    <script src="/js3/jquery.countdown.min.js"></script>
    <script src="/js3/jquery.slicknav.js"></script>
    <script src="/js3/owl.carousel.min.js"></script>
    <script src="/js3/jquery.nicescroll.min.js"></script>
    <script src="/js3/main.js"></script>
    <script src="/js/bootstrap.bundle.min.js"></script>
    <script src="/js/tiny-slider.js"></script>
    <script src="/js/custom.js"></script>
    <script src="/js/templateJS.js"></script>
    <script src="/js3/picZoom.js"></script>
    <script src="/js/removeFromCart.js"></script>
    <script src="/js3/couponCode.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script>
      const success_msg =
        "<%= success_msg && success_msg.length > 0 ? success_msg[0] : '' %>";
      const error_msg =
        "<%= error_msg && error_msg.length > 0 ? error_msg[0] : '' %>";

      if (success_msg && success_msg.length > 0) {
        Swal.fire({
          icon: 'success',
          title: 'Success',
          text: success_msg,
          confirmButtonColor: '#3085d6',
        });
      }

      if (error_msg && error_msg.length > 0) {
        Swal.fire({
          icon: 'error',
          title: 'Error',
          text: error_msg,
          confirmButtonColor: '#d33',
        });
      }
    </script>
  </body>
</html>
